<aura:component controller="ActionDetailController" implements="flexipage:availableForRecordHome,flexipage:availableForAllPageTypes,force:hasRecordId,force:lightningQuickAction,force:appHostable" access="global">
    <!--aura init handler , call js "loadData" function on component load, and display data on form-->
    <aura:handler name="cadDynamicRowEvent" event="c:CadDynamicRowEvent" action="{!c.handleCadDynamicRowEvent}"/>
    <aura:handler name="init" value="{!this}" action="{!c.doInit}"/>
    <!--Action Objects -->
    <aura:attribute name="newAction" type="Action__c" default="{ 'sobjectType': 'Action__c', 'Name': '','RDNACadence__Type__c':''}"/>
    <!--Task Objects -->
    <aura:attribute name="taskObj" type="Task" default="{ 'sobjectType': 'Task'}"/>
    <!--Email template list -->
    <aura:attribute name="listEmailTemplate" type="List"/>
    <!--SMS template list -->
    <aura:attribute name="listSMSTemplate" type="List"/>
    <!--List to show in template action template -->
    <aura:attribute name="listToShowInTemplateType" type="List"/>
    <!--Wrapper class having Task fields detail -->
    <aura:attribute name="wrapperTaskFields" type="object"/>
    <!--Task object list -Iterated to add multiple row(Multiple Task fields) -->
    <aura:attribute name="listTask" type="List"/>
    <!--Validation attribute -->
    <aura:attribute name="isActionTypeRequired" type="boolean" default='true' />
    <aura:attribute name="isValid" type="boolean" default='true' />
    <aura:attribute name="isValidationError" type="boolean" default='false' />
    <aura:attribute name="ValidationError" type="String" default='Validation Error' />
    <!--For edit page-->
    <aura:attribute name="recordId" type="Id"/>
    <aura:attribute name="recordName" type="String" default='New Cadence Action'/>
    <aura:attribute name="defaultValue" type="Boolean" default='false'/>
    <aura:attribute name="themeName" type="String"/>
    
    <!-- PAGE HEADER -->
    <div class="slds-page-header" style="background-color: #fafafa">
        <div class="slds-grid">
            <div>
                <img class = "rdna-logo" src="{!$Resource.cadence_icons + '/rdna-logo/rdna-logo@2x.png'}"/>
            </div>
            <div class="slds-col slds-has-flexi-truncate slds-m-left_small">
                <!-- HEADING AREA -->
                <p class="slds-line-height_reset rdna-header-small">Cadence Actions</p>
                <h1 class="slds-page-header__title slds-m-right_small slds-align-middle slds-truncate rdna-header-large"  title="New Cadence Action">{!v.recordName}</h1>
                <!-- / HEADING AREA -->
            </div>
            <div>
                <lightning:button class="rdna-button rdna-button-text slds-text-align_center slds-m-top_large slds-m-right_medium slds-p-left_large slds-p-right_large" aura:id="cancel" label="Cancel" onclick="{!c.onCancel}"/>
            </div>    
            <div>
                <lightning:button class="rdna-button rdna-button-text slds-text-align_center slds-m-top_large slds-p-left_large slds-p-right_large" aura:id="deleteActions" label="Save" onclick="{!c.clickCreate}"/>
            </div>
        </div>
        
        <!-- Body Start -->
        <div class="slds-box_xx-small">
            <fieldset class="slds-form-element slds-form_compound">
                <!-- CREATE NEW ACTION FORM -->
                <form class="slds slds-form slds-m-left_large">
                    
                    <p class="slds-page-header__row slds-m-top_large slds-truncate slds-align_absolute-center rdna-sub-header-bold" >Action Details</p>
                    <p class="slds-align_absolute-center slds-m-bottom_large rdna-sub-header" style="padding-top:15px;">Enter the details of your new cadence action which can be added to any cadence list.</p>
                    
                    <div class="slds-form-element__row slds-p-top_small">
                        <div class="slds-form-element__control slds-size_1-of-4">
                            <lightning:select aura:id="formValidationId" name="selectActionType" 
                                              label="Type" required="true" value="{!v.newAction.RDNACadence__Type__c}" 
                                              messageWhenValueMissing="Please Select Action Type."
                                              onchange="{!c.updateActionType}">
                                <option value="">Select Action Type</option>
                                <option value="Email">Email</option>
                                <option value="SMS">SMS</option>
                                <option value="Call">Call</option>
                                <option value="Call+Voicemail">Call+Voicemail</option>
                                <option value="Task">Task</option>
                            </lightning:select>
                        </div>
                        <div class="slds-form-element__control slds-size_1-of-4 slds-m-left_medium">
                            <lightning:input aura:id="formValidationId" label="Name"
                                             name="actionname"
                                             value="{!v.newAction.Name}"
                                             placeholder = "Enter Action Name"
                                             messageWhenBadInput = "Please Enter Name"
                                             required="true"/> 
                        </div>
                        
                        <aura:if isTrue="{!v.newAction.RDNACadence__Type__c == 'Email'}">                        
                            <div class="slds-form-element__control slds-size_1-of-4 slds-m-left_medium">
                                <lightning:select aura:id="formValidationId" name="selectActionType" 
                                                  label="Activation Type" required="true" value="{!v.newAction.RDNACadence__Activation_Type__c}" 
                                                  messageWhenValueMissing="Please Select Activation Type.">
                                    <option value="">Select Activation Type</option>
                                    <option value="Automatic">Automatic</option>
                                    <option value="Manual">Manual</option>
                                </lightning:select>
                            </div>                       
                            
                            <aura:set attribute="else">
                                <aura:if isTrue="{!v.newAction.RDNACadence__Type__c == 'Task'}"> 
                                    <div class="slds-form-element__control slds-size_1-of-4 slds-m-left_medium">
                                        <lightning:select aura:id="formValidationId" name="selectActionType"
                                                          label="Activation Type"
                                                          value="{!v.newAction.RDNACadence__Activation_Type__c}">
                                            <option value="">Select Activation Type</option>
                                            <option value="Automatic">Automatic</option>
                                        </lightning:select>
                                    </div>
                                    
                                    <aura:set attribute="else">
                                        <div class="slds-form-element__control slds-size_1-of-4 slds-m-left_medium">
                                            <lightning:select aura:id="formValidationId" name="selectActionType"
                                                              label="Activation Type" 
                                                              value="{!v.newAction.RDNACadence__Activation_Type__c}" >
                                                <option value="">Select Activation Type</option>
                                                <option value="Manual">Manual</option>
                                            </lightning:select>
                                        </div>
                                    </aura:set>    
                                </aura:if>
                                
                            </aura:set>    
                        </aura:if>     
                    </div>
                    
                    <span class="rdna-template-bold slds-p-top_medium slds-page-header__row slds-text-title_bold slds-truncate">Action Template</span>
                    <span class="rdna-styling">Enter the details of your new cadence action which can be added to any cadence list.</span>
                    <div class="slds-form-element__row slds-p-top_small">
                        <div class="slds-form-element__control slds-size_1-of-4 slds-p-bottom_large" aura:id = "InputSelectTemplate">
                            <lightning:select aura:id="formValidationId" name="selectActionType" 
                                              label="Type" required="{!v.isActionTypeRequired}" value="{!v.newAction.RDNACadence__Template_Id__c}" 
                                              messageWhenValueMissing="Please Select Template Type.">
                                <option value="">Select Template</option>
                                <aura:iteration items="{!v.listToShowInTemplateType}" var="templateObj" indexVar="selectedIndex">
                                    <option value="{!selectedIndex}">{!templateObj.Name}</option>
                                </aura:iteration>
                            </lightning:select>
                        </div>
                        <div class = "slds-form-element slds-size_1-of-1 slds-hide slds-p-bottom_large" aura:id = "createTaskdiv">
                            <aura:iteration items="{!v.listTask}" var="taskObj" indexVar="index">
                                <div class = "slds-form-element__row slds-size_1-of-1">
                                    <c:ActionDetailsDynamicRow taskObj="{!taskObj}" wrapperTaskFields="{!v.wrapperTaskFields}" currentIndex = "{!index}" listPicklistValues="" dataType = ""/>
                                </div>
                            </aura:iteration>
                            <div class = "slds-form-element__row slds-size_1-of-1">
                                <a onclick="{!c.AddNewRow}"> 
                                    <label>+ Add Field</label>
                                </a>    
                            </div>
                            <div class = "slds-form-element__row slds-size_1-of-1">
                                <!--Validation -->
                                <aura:if isTrue="{!v.isValidationError}">
                                    <div aura:id="msg" class="slds-text-color_error slds-text-heading_small slds-text-align_center">
                                        <ui:outputText value="{!v.ValidationError}" />
                                    </div>
                                </aura:if>
                            </div>
                        </div> 
                    </div>
                </form>
            </fieldset>
        </div>
    </div>
    
</aura:component>